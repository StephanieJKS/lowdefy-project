id: results
type: PageHeaderMenu
properties:
  title: What others think of us # The title in the browser tab.
layout:
  contentGutter: 16
  contentJustify: center # Center the contents of the page.

requests:
  # Request for the bar and pie charts
  - id: count_stars_food
    type: MongoDBAggregation # MongoDB Aggregation to get the data
    connectionId: my_collection
    properties:
      pipeline:
        - $group:
            _id: $food # Group data by the genre field
            count: 
              $sum: 1 # Count the number of documents by summing 1 for every documentewerRating

  # Request for the bar and pie charts
  - id: count_stars_service
    type: MongoDBAggregation # MongoDB Aggregation to get the data
    connectionId: my_collection
    properties:
      pipeline:
        - $group:
            _id: $service # Group data by the genre field
            count: 
              $sum: 1 # Count the number of documents by summing 1 for every documentewerRating

  # Request for the bar and pie charts
  - id: count_stars_atmosphere
    type: MongoDBAggregation # MongoDB Aggregation to get the data
    connectionId: my_collection
    properties:
      pipeline:
        - $group:
            _id: $atmosphere # Group data by the genre field
            count: 
              $sum: 1 # Count the number of documents by summing 1 for every documentewerRating

  # Request for the bar and pie charts
  - id: count_stars_overall
    type: MongoDBAggregation # MongoDB Aggregation to get the data
    connectionId: my_collection
    properties:
      pipeline:
        - $group:
            _id: $overall # Group data by the genre field
            count: 
              $sum: 1 # Count the number of documents by summing 1 for every documentewerRating

events:
  # A list of actions that gets completed when this page is first loaded. 
  onInitAsync:
    - id: fetch_data # Fetch the request data before the page renders in order to populate the charts
      type: Request
      params: 
        - count_stars_food
        - count_stars_service
        - count_stars_atmosphere
        - count_stars_overall

areas:
  content:
    blocks:
      - id: title # Title on page
        type: Title
        properties:
          content: Ratings
          level: 4

      - id: pie_chart_card_food
        type: Card
        layout:
          span: 5
        properties:
          title: Food Rating
        blocks:
          - id: pie_chart_food
            type: AmChartsPie
            properties:
              height: 400
              data:
                _request: count_stars_food # Share the same request as the bar chart
              innerRadius: 50% # Make the chart a donut chart
              series:
                - type: PieSeries
                  alignLabels: false  # Needed for bent labels
                  ticks:
                    disabled: true # Remove label ticks
                  labels:
                    bent: true
                    fontSize: 12
                    text: "{category}"
                  dataFields:
                    category: _id
                    value: count
                  colors: # Add custom colors
                    list:
                      - '#122C6A'
                      - '#0044A4'
                      - '#005BBF'
                      - '#3874DB'
                      - '#5A8DF8'
                      - '#7EABFF'

      - id: pie_chart_card_service
        type: Card
        layout:
          span: 5
        properties:
          title: Service Rating
        blocks:
          - id: pie_chart_service
            type: AmChartsPie
            properties:
              height: 400
              data:
                _request: count_stars_service # Share the same request as the bar chart
              innerRadius: 50% # Make the chart a donut chart
              series:
                - type: PieSeries
                  alignLabels: false  # Needed for bent labels
                  ticks:
                    disabled: true # Remove label ticks
                  labels:
                    bent: true
                    fontSize: 12
                    text: "{category}"
                  dataFields:
                    category: _id
                    value: count
                  colors: # Add custom colors
                    list:
                      - '#122C6A'
                      - '#0044A4'
                      - '#005BBF'
                      - '#3874DB'
                      - '#5A8DF8'
                      - '#7EABFF'

      - id: pie_chart_card_atmosphere
        type: Card
        layout:
          span: 5
        properties:
          title: Atmosphere Rating
        blocks:
          - id: pie_chart_atmosphere
            type: AmChartsPie
            properties:
              height: 400
              data:
                _request: count_stars_atmosphere # Share the same request as the bar chart
              innerRadius: 50% # Make the chart a donut chart
              series:
                - type: PieSeries
                  alignLabels: false  # Needed for bent labels
                  ticks:
                    disabled: true # Remove label ticks
                  labels:
                    bent: true
                    fontSize: 12
                    text: "{category}"
                  dataFields:
                    category: _id
                    value: count
                  colors: # Add custom colors
                    list:
                      - '#122C6A'
                      - '#0044A4'
                      - '#005BBF'
                      - '#3874DB'
                      - '#5A8DF8'
                      - '#7EABFF'

      - id: pie_chart_card_overall
        type: Card
        layout:
          span: 5
        properties:
          title: Overall Rating
        blocks:
          - id: pie_chart_overall
            type: AmChartsPie
            properties:
              height: 400
              data:
                _request: count_stars_overall # Share the same request as the bar chart
              innerRadius: 50% # Make the chart a donut chart
              series:
                - type: PieSeries
                  alignLabels: false  # Needed for bent labels
                  ticks:
                    disabled: true # Remove label ticks
                  labels:
                    bent: true
                    fontSize: 12
                    text: "{category}"
                  dataFields:
                    category: _id
                    value: count
                  colors: # Add custom colors
                    list:
                      - '#122C6A'
                      - '#0044A4'
                      - '#005BBF'
                      - '#3874DB'
                      - '#5A8DF8'
                      - '#7EABFF'