id: ratings
type: PageHeaderMenu
properties:
  logo:
    src: https://t4.ftcdn.net/jpg/03/12/53/09/240_F_312530923_wxvZKwzM1Dl5APTugPDEXCvTgsV0y3gl.jpg
    style:
      height: 50
  title: Ratings # The title in the browser tab.
  header:
    theme: dark
    color: '#002B24'
layout:
  contentGutter: 16
  contentJustify: center # Center the contents of the page.

requests:
  # Request for the bar and pie charts
  - id: count_stars_food
    type: MongoDBAggregation # MongoDB Aggregation to get the data
    connectionId: my_collection
    properties:
      pipeline:
        - $group:
            _id: $food # Group data by the genre field
            count: 
              $sum: 1 # Count the number of documents by summing 1 for every documentewerRating
        - $sort:
            _id: 1

  # Request for the bar and pie charts
  - id: count_stars_service
    type: MongoDBAggregation # MongoDB Aggregation to get the data
    connectionId: my_collection
    properties:
      pipeline:
        - $group:
            _id: $service # Group data by the genre field
            count: 
              $sum: 1 # Count the number of documents by summing 1 for every documentewerRating
        - $sort:
            _id: 1

  # Request for the bar and pie charts
  - id: count_stars_atmosphere
    type: MongoDBAggregation # MongoDB Aggregation to get the data
    connectionId: my_collection
    properties:
      pipeline:
        - $group:
            _id: $atmosphere # Group data by the genre field
            count: 
              $sum: 1 # Count the number of documents by summing 1 for every documentewerRating
        - $sort:
            _id: 1

  # Request for the bar and pie charts
  - id: count_stars_overall
    type: MongoDBAggregation # MongoDB Aggregation to get the data
    connectionId: my_collection
    properties:
      pipeline:
        - $group:
            _id: $overall # Group data by the genre field
            count: 
              $sum: 1 # Count the number of documents by summing 1 for every documentewerRating
        - $sort:
            _id: 1

  # Request for the bar and pie charts
  - id: count_visit_again
    type: MongoDBAggregation # MongoDB Aggregation to get the data
    connectionId: my_collection
    properties:
      pipeline:
        - $group:
            _id: $visit_again # Group data by the genre field
            count: 
              $sum: 1 # Count the number of documents by summing 1 for every documentewerRating
        - $sort:
            _id: -1

  # Request for the bar and pie charts
  - id: get_ave
    type: MongoDBAggregation # MongoDB Aggregation to get the data
    connectionId: my_collection
    properties:
      pipeline:
        - $group:
            _id: null # Group data by the genre field
            ave_food:
              $avg: $food # Count the number of documents by summing 1 for every documentewerRating
            ave_service: 
              $avg: $service
            ave_atmosphere:
              $avg: $atmosphere
            ave_overall:
              $avg: $overall

events:
  # A list of actions that gets completed when this page is first loaded. 
  onInitAsync:
    - id: fetch_data # Fetch the request data before the page renders in order to populate the charts
      type: Request
      params: 
        - count_stars_food
        - count_stars_service
        - count_stars_atmosphere
        - count_stars_overall
        - count_visit_again
        - get_ave

    - id: set_averages
      type: SetState
      params:
        average_list:
          _request: get_ave

areas:
  content:
    blocks:
      - id: title # Title on page
        type: Title
        properties:
          content: Ratings
          level: 2

      - id: pie_chart_card_food
        type: Card
        layout:
          span: 5
        properties:
          title: Food Rating
        blocks:
          - id: pie_chart_food
            type: AmChartsPie
            properties:
              height: 280
              data:
                _request: count_stars_food # Share the same request as the bar chart
              series:
                - type: PieSeries
                  labels:
                    fontSize: 12
                    text: "{category}"
                  dataFields:
                    category: _id
                    value: count
                  colors: # Add custom colors
                    list:
                      - "#62BEB6"
                      - "#0B9A8D"
                      - "#077368"
                      - "#034D44"
                      - "#002B24"

      - id: pie_chart_card_service
        type: Card
        layout:
          span: 5
        properties:
          title: Service Rating
        blocks:
          - id: pie_chart_service
            type: AmChartsPie
            properties:
              height: 280
              data:
                _request: count_stars_service # Share the same request as the bar chart
              series:
                - type: PieSeries
                  labels:
                    fontSize: 12
                    text: "{category}"
                  dataFields:
                    category: _id
                    value: count
                  colors: # Add custom colors
                    list:
                      - "#62BEB6"
                      - "#0B9A8D"
                      - "#077368"
                      - "#034D44"
                      - "#002B24"

      - id: pie_chart_card_atmosphere
        type: Card
        layout:
          span: 5
        properties:
          title: Atmosphere Rating
        blocks:
          - id: pie_chart_atmosphere
            type: AmChartsPie
            properties:
              height: 280
              data:
                _request: count_stars_atmosphere # Share the same request as the bar chart
              series:
                - type: PieSeries
                  labels:
                    fontSize: 12
                    text: "{category}"
                  dataFields:
                    category: _id
                    value: count
                  colors: # Add custom colors
                    list:
                      - "#62BEB6"
                      - "#0B9A8D"
                      - "#077368"
                      - "#034D44"
                      - "#002B24"

      - id: pie_chart_card_overall
        type: Card
        layout:
          span: 5
        properties:
          title: Overall Rating
        blocks:
          - id: pie_chart_overall
            type: AmChartsPie
            properties:
              height: 280
              data:
                _request: count_stars_overall # Share the same request as the bar chart
              series:
                - type: PieSeries
                  labels:
                    fontSize: 12
                    text: "{category}"
                  dataFields:
                    category: _id
                    value: count
                  colors: # Add custom colors
                    list:
                      - "#62BEB6"
                      - "#0B9A8D"
                      - "#077368"
                      - "#034D44"
                      - "#002B24"
      
      - id: average_ratings
        type: Card
        style:
          maxWidth: 380
          padding: 60px
        properties:
          title: Average Ratings
        blocks:
          - id: average_ratings
            type: Descriptions
            layout:
              align: middle
            style:
              height: 280
            properties:
              column: 1
              itemOptions: []
              items:
                - label: Food
                  value: 
                    _state: average_list.0.ave_food
                  span: null
                  style: null
                - label: Service
                  value: 
                    _state: average_list.0.ave_service
                  span: null
                  style: null
                - label: Atmosphere
                  value: 
                    _state: average_list.0.ave_atmosphere
                  span: null
                  style: null
                - label: Overall
                  value: 
                    _state: average_list.0.ave_overall
                  span: null
                  style: null

      - id: pie_chart_card_visit_again
        type: Card
        layout:
          span: 5
        properties:
          title: Visit Us Again
        blocks:
          - id: pie_chart_visit_again
            type: AmChartsPie
            properties:
              height: 280
              data:
                _request: count_visit_again # Share the same request as the bar chart
              series:
                - type: PieSeries
                  labels:
                    bent: true
                    fontSize: 14
                    text: "{category}"
                  dataFields:
                    category: _id
                    value: count
                  colors: # Add custom colors
                    list:
                      - "#62BEB6"
                      - "#002B24"

  footer:
    blocks:
      - id: footer
        type: Paragraph
        properties:
          type: secondary
          content: |
            Made using Lowdefy